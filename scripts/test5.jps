type: install
name: Standalone Pro

baseUrl: https://raw.githubusercontent.com/sych74/import-addon/WP-349
  
globals:
  wp_admin_pass: ${fn.password(10)}
  db_user: user-${fn.random}
  db_pass: ${fn.password(10)}
  env_name: wp-${fn.random}
  envGroups: "${settings.envGroups}"
  project_name: "${settings.project_name}"
  migration_dir: "/home/jelastic/migrator"
  wpenv_file: "/home/jelastic/migrator/.wpenv"
  wpenv_file_content: "${settings.wpenv_file_content}"
  projects_file: "/home/jelastic/migrator/projects.json"
  projects_file_content: "${settings.projects_file_content}"
  
onInstall:
  - log: ------ ${settings.projects_file_content}
  - addConfigs

actions:
 
  addConfigs:
    - projects_file_content: ${settings.projects_file_content}
      script: |
        var envInfo = jelastic.env.control.GetEnvInfo('${env.envName}', session);
        if (envInfo.result != 0) return envInfo;
        for (var i = 0, k = envInfo.nodes; i < k.length; i++) {
          if (k[i].nodeGroup == 'cp')
            master_id = k[i].id;
        }       
        var cmd3 = "echo '" + projects_file_content + "'  > /tmp/projects_file_content;";
        return api.environment.control.ExecCmdById({
          envName: "${env.envName}", 
          session: session,
          nodeId: master_id, 
          commandList: toJSON([{"command": cmd3}])
        });
 
