type: install
name: Standalone Pro
  
onInstall:
  - log: ------ ${settings.projects_file_content}
  - addConfigs

actions:
 
  addConfigs:
    - projects_file_content: ${settings.projects_file_content}
      wpenv_file_content: ${settings.wpenv_file_content}
      script: |
        var envInfo = jelastic.env.control.GetEnvInfo('${env.envName}', session);
        if (envInfo.result != 0) return envInfo;
        for (var i = 0, k = envInfo.nodes; i < k.length; i++) {
          if (k[i].nodeGroup == 'cp')
            master_id = k[i].id;
        }       
        
        var cmd1 = "echo '" + wpenv_file_content + "'  > /tmp/wpenv_file_content;";
        var cmd2 = "echo 'PROJECT_NAME=${settings.project_name}' >> /tmp/wpenv_file_content;";
        var cmd3 = "echo '" + projects_file_content + "'  > /tmp/projects_file_content;";

        return api.environment.control.ExecCmdById({
          envName: "${env.envName}", 
          session: session,
          nodeId: master_id, 
          commandList: toJSON([{"command": cmd1}, {"command": cmd2}, {"command": cmd3}])
        });
 
