type: install
name: Standalone Pro
baseUrl: https://raw.githubusercontent.com/sych74/import-addon/WP-349
  
globals:
  master_env: ${settings.master_env}
  wp_admin_pass: ${fn.password(10)}
  db_user: user-${fn.random}
  db_pass: ${fn.password(10)}
  env_name: wp-${fn.random}
  envGroups: "${settings.envGroups}"
  project_id: "${settings.project_id}"
  migration_dir: "/home/jelastic/migrator"
  wpenv_file: "/home/jelastic/migrator/.wpenv"
  projects_file: "/home/jelastic/migrator/projects.json"
  
onInstall:
  - createEnv
  - importLogic

actions:
  createEnv:
    script: |
      return jelastic.billing.subscription.InstallProduct({
          appid: 'dashboard', 
          session: '${settings.userSession}', 
          subscriptionId: '${settings.subscriptionId}',
          settings: { 
            envName: '${globals.env_name}' 
          }      
        });   
  
  importLogic:
    script: |
      return marketplace.jps.install({
          appid: 'dashboard', 
          session: '${settings.userSession}', 
          subscriptionId: '${settings.subscriptionId}',
          jps: '${baseUrl}/scripts/importLogic.jps',
          envName: '${globals.env_name}' 
      });   
    
