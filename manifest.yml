type: update
jpsVersion: 6.1.1
name: WordPress Import
id: wp-import
targetEditions: any
logo: /images/backup-logo.svg
description: Add-On for impoer the WordPress applications.
baseUrl: https://raw.githubusercontent.com/sych74/import-addon/master

targetNodes:
  nodeType:
    - nginxphp
    - litespeedphp
    - lemp
    - llsmp

settings:
  ssh:
    fields:
      - type: string
        name: ssh_host
        caption: SSH Host
        default: ''
        required: true
      - type: string
        name: ssh_port
        caption: SSH Port
        default: ''
        required: true
      - type: string
        name: ssh_user
        caption: SSH User
        default: ''
        required: true
      - type: string
        inputType: password
        name: ssh_pass
        caption: SSH Password
        default: ''
        required: true
        
      - type: separator

  deploy:
    fields: []
    onBeforeInit: scripts/importOnBeforeInit.js
      
buttons:
- caption: Get SSH projects
  action: getSSHprojects
  settings: ssh
  title: cPanel/plesk SSH connection
  loadingText: Getting WordPress projects...
  successText: List of WordPress projects received successfully.
  
- caption: Import
  action: deployProject
  loadingText: Deploying...
  settings: deploy
  successText: The Wordpress project have been successfully deployed.
  title: Deploy Project
  submitButtonText: Deploy project
  confirmText: You are going to deploy project, which will override all your existing data. This action cannot be canceled or reverted. Do you want to proceed?

globals:
  scriptSufix: wp-import
  migration_dir: /home/jelastic/migrator

onInstall:
  - installDependencies

actions:
  installDependencies:
    - cmd[${nodes.cp.master.id}]: |-
        rpm -qa | grep -qw sshpass || yum install sshpass -y;
      user: root
    - cmd[${nodes.cp.master.id}]: |-
        [[ -d ${globals.migration_dir} ]] || mkdir ${globals.migration_dir};
        wget ${baseUrl}/scripts/migrator.sh -O ${globals.migration_dir}/migrator.sh;

  getSSHprojects:
    - installDependencies:
    - cmd[${nodes.cp.master.id}]: |-
        bash ${globals.migration_dir}/migrator.sh getSSHprojects --ssh-user=${settings.ssh_user} --ssh-password=${settings.ssh_pass} --ssh-host=${settings.ssh_host} --ssh-port=${settings.ssh_port};
        
  deployProject:
    - cmd[${nodes.cp.master.id}]: |-
        bash ${globals.migration_dir}/migrator.sh deployProject --project-name=${settings.project};
